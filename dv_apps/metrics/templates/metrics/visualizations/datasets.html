{% load humanize %}
<div id="viz-dataset_counts_by_month" class="viz"></div>
<script>

  var datasets_by_month = [
    {%for i in dataset_counts_by_month%}

    {"Month": "{{ i.month_name }} {{ i.year_num }}", "monthNum": {{ i.month_num }}, "name":"Total Datasets", "Number of Published Datasets": {{ i.running_total }}, "month_sort" : "{{ i.yyyy_mm }}",  "display_name":"{{ i.month_name }} {{ i.year_num }}: {{ i.cnt|intcomma }} new Datasets; Total of {{ i.running_total|intcomma }} "}
    {#{"Month": "{{ i.month_name }} {{ i.year_num }}", "monthNum": {{ i.month_num }}, "name":"Monthly Datasets", "Number of Published Datasets": {{ i.cnt }}, "month_sort" : "{{ i.yyyy_mm }}",  "display_name":"{{ i.month_name }} {{ i.year_num }}: {{ i.cnt|intcomma }} new Datasets; Total of {{ i.running_total|intcomma }} "}#}
    {%if not forloop.last%},{%endif%}
    {%endfor%}
  ]

  var y_axis_vals = [{%for i in dataset_counts_by_month%}{{ i.running_total }}{%if not forloop.last%},{%endif%}{%endfor%}]


  // instantiate d3plus
   var attributes = [
    {"name": "Total Datasets", "hex": "#E58433"},
    {"name": "Monthly Datasets", "hex": "#ffcc00"}
  ]

  var visualization = d3plus.viz()
    .container("#viz-dataset_counts_by_month")  // container DIV to hold the visualization
    .data(datasets_by_month)  // data to use with the visualization
    .type("line")       // visualization type
    .id("name")         // key for which our data is unique on
    .text({"html":"true", "value":"display_name"})       // key to use for display text
    .y("Number of Published Datasets")         // key to use for y-axis
    .x({"value":"Month"})          // key to use for x-axis
    .attrs(attributes)
    .color("hex")
    .order({
        "sort": "asc",
        "value": "month_sort"
     })
    .resize(true)
    .title("Growth Over Time")
    //.footer("{%lorem%}")

    .draw()             // finally, draw the visualization!

</script>
